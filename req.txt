
开发一个Windows全局透明代理软件，名称叫TProxy，将本机的网络流量更具规则转发给代理服务器或是直连，类似Proxifier简化版本。

先理清用户需求规范，并画图。然后再列出需要的技术实现，使用最佳软件分析架构方法（MVVM，设计模式，测试驱动开发，架构分析设计比如使用Clean Architecture），画出程序架构图（Mermaid图，这样能看清依赖关系）。最后再分解成一个个的任务来实现。

内核使用singbox：
	根据用户设置的路由规则列表来修改singbox配置文件供singbox使用；

能监测代理回环：自身，内核（比如singbox），上游代理服务器应用使用直连。
保存与加载设置：
		自动保存设置，保存位置与应用程序同目录，代理服务规则设置保存到rules.json，显示偏好设置保存到preference.json
		程序启动后，从rules.json加载代理服务规则设置，从preference.json加载UI偏好设置。

界面支持切换多语言显示。多语言配置文件保存在 {语言名字简写}.language的json文件里。

界面支持更换主题颜色，主题颜色保存到 {主题名字}.theme的json文件里。

界面功能：
1. 工具栏：
	1.1 代理服务器的管理按钮：
		代理服务器列表属于代理服务规则设置。
		点击弹出代理服务器管理界面。
		代理服务器管理界面是个表格，显示代理服务器的名称，地址，端口，协议类型。
		右侧是操作功能按钮，包括以下功能：
			添加代理服务器，配置代理服务器的名称（唯一），地址，端口和协议（有http, socks5协议）
			修改选中的代理服务器配置；
			删除选中的代理服务器配置；如果有引用此代理服务器配置的，弹出界面显示引用此代理服务器配置的路由规则列表，并能为这些路由规则更改路由行为（直连，封锁，其他代理服务器配置）。
			能检查选中的代理服务器连接情况:
				调用代理服务器检查器检查，代理服务器检查器要测试以下项目：
					测试连接到代理服务器是否正常；
					测试使用选中的代理服务器访问指定网址是否正常，可以自定义网址，缺省网址是google.com:80;
					测试选中的代理服务器的连接延迟；
					
					代理服务器检查器界面：
						显示要检查的代理服务器的地址，协议。
						每个测试项目的有开关。
						日志窗口显示所有测试的结果，成功显示绿色，失败显示红色。
						
	1.2 路由规则配置按钮：
		路由规则列表属于代理服务规则设置。
		点击后弹出路由规则配置界面。
			1. 路由规则有多条，用表格显示，表格每行有以下几个属性和说明：
				1. 是否启用：表示是否启用本条规则。在界面上显示复选框。
				2. 路由规则名称：规则的名称。
				3. 应用程序名称：匹配应用程序进程名称。如果留空表示匹配任何程序，在表格CELL里显示灰色文字"任何"。
				4. 目标 hosts：匹配访问的目标 hosts。如果留空表示匹配任何，在表格CELL里显示灰色文字"任何"。
				5. 目标 ports：匹配访问的目标 ports。如果留空表示匹配任何，在表格CELL里显示灰色文字"任何"。
				6. 路由行为: 直连，走指定的代理服务器还是封锁。在表格CELL里显示下拉单选框。
			
			2. 双击选中的路由规则行，弹出编辑路由规则属性对话框。
				对于默认路由规则(见下面描述），双击不可编辑，弹出对话框提醒“无法编辑默认路由规则”。
				路由规则表格下边缘提供“添加”“复制”“编辑”“移除”按钮来对路由规则表格进行操作，具体功能描述：
				1. 添加：弹出添加新路由规则界面。要编辑的属性包括：
					是否启用；
					路由规则名称，单行文本，对于新建规则默认填写“新规则”；合法值：英文字符，不为空。
					应用程序名称，多行文本，显示占位符"任何"；多个值用分号隔开；合法值：英文字符，无特殊符号，可为空。
					目标 hosts，多行文本，显示占位符"任何"；多个值用分号隔开；合法值：英文字符，无特殊符号，可为空。
					目标 ports，单行文本，显示占位符"任何"；多个值用分号隔开；合法值：英文字符，无特殊符号，可为空。
					路由行为，下拉单选列表框：空，直连，指定的代理服务器，封锁。默认为空。空值是非法的。
					
					窗口最下边缘显示以下按钮和功能：
						确定：检查各属性值是否合法，如果都合法就将此路由规则添加到路由规则表，然后关闭界面，否则提醒不合法的属性值。
						取消：不做任何更改，然后关闭界面。
					
				2. 复制：复制选中的路由规则。复制出来的新路由规则名字格式为"复制 自 {原路由规则名}"，其他路由规则属性保持与被复制的一样。
				3. 编辑：弹出路由规则属性编辑界面（重用添加新路由规则界面，窗口标题改为编辑路由属性）。
				
			3. 每条路由规则按照从上到下来处理，路由规则表格右侧有调整路由规则顺序的上下箭头按钮；
			4. 最下是一个默认路由规则，当上面没有匹配的路由规则时使用这个默认的路由规则。具体要求：
				不能更改顺序，始终在所有路由规则的最下；
				除了更改路由行为（直连还是走指定的代理服务器）以外，其他项不能编辑。
				具体各属性值为：是否启用：启用；名称：默认；应用程序名称：留空; 目标 hosts：留空；目标 ports：留空；
				
			5. 界面最下边提供以下按钮和功能：
				1. 确认：应用保存路由规则的修改，然后关闭界面。
				2. 取消：不应用路由规则的修改，然后关闭界面。
				
	1.3 DNS设置：
		DNS设置属于代理服务规则设置。
		点击后弹出DNS配置界面:
			提供以下选项：
			1.默认DNS设置；
			2. 通过代理解析DNS；

2. 主窗口功能：
	主窗口上半部分显示当前联网进程的连接情况表格：
		表格列头可调整宽度。
		进程的连接情况包括：进程名字，目标地址和端口，连接时长和状态，使用的路由规则（代理，直连还是封锁），发送的流量，收到的流量，上传速度，下载速度。
		进程的连接情况文字颜色根据进程的网络连接状态更改；
			正在请求连接时，字体时蓝色；
			连接出错，文字变红色；
			连接成功，文字变黑灰色；
			连接关闭，文字变灰，两秒后从表格消失。
		新的连接显示在表格的最后一行。
		表格上边缘提供以下功能：
			搜索过滤：输入关键字，仅显示文本内容（进程的连接情况所有属性）匹配关键字的所有行。
			显示直连：是否显示直连的进程连接状态。默认否。属于UI显示偏好设置。
			
3：主窗口下半部分显示程序输出日志和第三方程序（包括singbox）的日志。
	程序启动后，自动实时写入日志到文件，日志文件名格式为{年-月-日-小时-分钟-秒}.log
	日志内容以只读文本组件显示，每条日志换行显示，能选择复制文本内容。
	普通日志的文字是默认的黑灰色；
	日志种含有error，warning，warn，failed时，则以红色文字显示这条日志。
	日志显示窗口上边缘有以下功能：
		搜索过滤：输入关键字能使日志窗口仅显示匹配的日支行，不匹配的日志行会被隐藏。清空搜索过滤输入框后，又恢复全部日志内容显示。
		清除日志：清除所有日志。
		自动刷新：自动刷新日志。默认开启。属于UI显示偏好设置。
		自动滚动：自动滚动到日志行尾。默认开启。属于UI显示偏好设置。